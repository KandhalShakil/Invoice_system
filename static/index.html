<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ðŸ“‹ Invoice Management System - Smart Business Solution</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23138808' width='100' height='100' rx='20'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>ðŸ“‹</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        html {
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            html {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #2c3e50;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            max-width: 100vw;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
        }

        .header {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #ff9933;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 20px;
                border-width: 2px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 15px;
                border-radius: 15px;
                margin-bottom: 20px;
            }
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff9933, #ffffff, #138808);
            animation: slideBar 3s linear infinite;
        }

        @keyframes slideBar {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            color: #138808;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
            .header {
                padding: 20px 15px 15px 15px;
            }
            .header p {
                margin-bottom: 5px;
            }
        }

        .header p {
            color: #ff9933;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .header p {
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .header p {
                font-size: 0.9em;
            }
        }

        .nav-tabs {
            display: flex;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            border: 2px solid #e9ecef;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 5px;
                gap: 5px;
            }
        }

        .nav-tab {
            flex: 1;
            min-width: 100px;
            padding: 18px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.4s ease;
            margin: 0 3px;
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .nav-tab {
                padding: 12px 15px;
                font-size: 0.9em;
                margin: 2px;
            }
        }
        
        @media (max-width: 480px) {
            .nav-tab {
                flex: 1 1 45%;
                padding: 10px 8px;
                font-size: 0.8em;
            }
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,153,51,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab:hover {
            background: rgba(255, 153, 51, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #138808 0%, #28a745 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(19, 136, 8, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .card {
                padding: 20px;
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .card {
                padding: 15px;
                border-radius: 12px;
                margin-bottom: 15px;
            }
        }
        
        .card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff9933 0%, #ffffff 50%, #138808 100%);
        }

        .card h2 {
            color: #138808;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 700;
            border-bottom: 3px solid #ff9933;
            padding-bottom: 12px;
            display: inline-block;
            position: relative;
        }
        
        @media (max-width: 768px) {
            .card h2 {
                font-size: 1.5em;
            }
        }
        
        @media (max-width: 480px) {
            .card h2 {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
        }
        
        .card h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 50%;
            height: 3px;
            background: #138808;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1.1em;
            transition: all 0.3s ease;
            background: #ffffff;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        @media (max-width: 768px) {
            .form-group input, .form-group select, .form-group textarea {
                padding: 12px;
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .form-group input, .form-group select, .form-group textarea {
                padding: 10px;
                font-size: 0.95em;
            }
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #138808;
            box-shadow: 0 0 0 3px rgba(19, 136, 8, 0.1), inset 0 2px 4px rgba(0,0,0,0.05);
            transform: translateY(-1px);
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 4px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                width: 100%;
                margin: 2px 0;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 10px 16px;
                font-size: 0.85em;
                margin: 2px;
            }
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transition: width 0.6s, height 0.6s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0069d9 0%, #004494 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #138808 0%, #28a745 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #0f6606 0%, #218838 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(19, 136, 8, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9933 0%, #e67e22 100%);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 153, 51, 0.4);
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
        }
        
        @media (max-width: 768px) {
            .table-container {
                margin: 15px -15px;
                border-radius: 0;
            }
        }
        
        @media (max-width: 480px) {
            .table-container {
                margin: 10px -10px;
            }
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        @media (max-width: 768px) {
            table {
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            table {
                font-size: 0.8em;
            }
        }

        th, td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        @media (max-width: 768px) {
            th, td {
                padding: 12px 15px;
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            th, td {
                padding: 8px 10px;
                font-size: 0.85em;
                white-space: nowrap;
            }
        }

        th {
            background: linear-gradient(135deg, #138808 0%, #28a745 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.95em;
        }
        
        @media (max-width: 768px) {
            th {
                font-size: 0.85em;
                letter-spacing: 0.3px;
            }
        }
        
        @media (max-width: 480px) {
            th {
                font-size: 0.8em;
                letter-spacing: 0.2px;
            }
        }
        
        th:last-child, td:last-child {
            text-align: center;
        }

        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: linear-gradient(135deg, rgba(19, 136, 8, 0.05) 0%, rgba(255, 153, 51, 0.05) 100%);
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid #e9ecef;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .stat-card {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-card {
                padding: 15px;
            }
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff9933, #138808);
            transition: left 0.5s ease;
        }
        
        .stat-card:hover::before {
            left: 0;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 30px rgba(19, 136, 8, 0.2);
            border-color: #138808;
        }
        
        @media (max-width: 480px) {
            .stat-card:hover {
                transform: translateY(-4px) scale(1.01);
            }
        }

        .stat-card h3 {
            color: #138808;
            font-size: 2.5em;
            margin: 15px 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .stat-card h3 {
                font-size: 2em;
            }
        }
        
        @media (max-width: 480px) {
            .stat-card h3 {
                font-size: 1.5em;
                margin: 10px 0;
            }
        }

        .stat-card p {
            color: #ff9933;
            font-size: 1.1em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        @media (max-width: 768px) {
            .stat-card p {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            .stat-card p {
                font-size: 0.85em;
                letter-spacing: 0.5px;
            }
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(19,136,8,0.1), transparent);
            transition: left 0.8s ease;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(19, 136, 8, 0.2);
        }

        .stat-card h3 {
            color: #138808;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .stat-card p {
            color: #ff9933;
            font-size: 1.3em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .invoice-items {
            margin: 20px 0;
        }
        
        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .invoice-item {
                padding: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .invoice-item {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            .invoice-item {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
                align-items: flex-start;
            }
        }        .invoice-summary {
            background: #34495e;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .invoice-summary .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .invoice-summary .total {
            font-size: 1.3em;
            font-weight: bold;
            border-top: 1px solid #fff;
            padding-top: 10px;
        }

        .search-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-bar input {
            flex: 1;
            min-width: 250px;
            padding: 14px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        @media (max-width: 768px) {
            .search-bar input {
                min-width: 200px;
                padding: 12px 15px;
            }
        }
        
        @media (max-width: 480px) {
            .search-bar {
                gap: 8px;
            }
            .search-bar input {
                min-width: 100%;
                padding: 10px 12px;
                font-size: 0.95em;
            }
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: #138808;
            box-shadow: 0 0 0 3px rgba(19, 136, 8, 0.1);
        }
        
        .search-bar button {
            min-width: 120px;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            .invoice-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: #6c757d;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border: 2px dashed #dee2e6;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #138808;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .empty-state p {
            font-size: 1.1em;
            color: #6c757d;
        }

        /* Enhanced Popup Modal Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.1) 0%, rgba(19, 136, 8, 0.1) 50%, rgba(255, 255, 255, 0.1) 100%);
            backdrop-filter: blur(8px) saturate(150%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .popup-modal {
            background: #ffffff;
            padding: 35px 40px;
            border-radius: 20px;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            max-width: 600px;
            width: 95%;
            max-height: 85vh;
            text-align: center;
            transform: scale(0.8) translateY(30px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        @media (max-width: 1024px) {
            .popup-modal {
                padding: 30px 35px;
                max-width: 550px;
            }
        }
        
        @media (max-width: 768px) {
            .popup-modal {
                padding: 25px 30px;
                width: 90%;
                max-width: 500px;
                max-height: 80vh;
                border-radius: 18px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-modal {
                padding: 20px 15px;
                width: calc(100% - 30px);
                max-width: none;
                max-height: 90vh;
                border-radius: 15px;
            }
        }
        
        .popup-modal::-webkit-scrollbar {
            width: 8px;
        }
        
        .popup-modal::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .popup-modal::-webkit-scrollbar-thumb {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .popup-modal::-webkit-scrollbar-thumb:hover {
            background:  #f1f1f1;
        }
        
        .popup-modal::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background:  #f1f1f1;
            background-size: 300% 300%;
            border-radius: 22px;
            z-index: -1;
            animation: gradientBorder 3s ease infinite;
        }
        
        @keyframes gradientBorder {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .popup-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }
        
        .popup-overlay.show .popup-modal {
            transform: scale(1) translateY(0);
        }
        
        .popup-overlay.hide {
            animation: fadeOut 0.2s ease-in;
        }
        
        .popup-overlay.hide .popup-modal {
            transform: scale(0.9) translateY(20px);
            opacity: 0;
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .popup-modal h3 {
            color: #FF9933;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 700;
            text-shadow: none;
            position: relative;
            padding-bottom: 15px;
            display: inline-block;
            width: auto;
            left: 50%;
            transform: translateX(-50%);
        }
        
        @media (max-width: 768px) {
            .popup-modal h3 {
                font-size: 1.4em;
                margin-bottom: 15px;
                padding-bottom: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-modal h3 {
                font-size: 1.2em;
                margin-bottom: 12px;
                padding-bottom: 10px;
            }
        }
        
        .popup-modal h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 3px;
            background: #FF9933;
            border-radius: 2px;
        }
        
        .popup-modal p {
            color: #495057;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
            font-weight: 500;
            text-align: center;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        
        @media (max-width: 768px) {
            .popup-modal p {
                font-size: 1.05em;
                margin-bottom: 25px;
                line-height: 1.5;
            }
        }
        
        @media (max-width: 480px) {
            .popup-modal p {
                font-size: 0.95em;
                margin-bottom: 20px;
                line-height: 1.4;
                max-width: 100%;
            }
        }
        
        .popup-modal input,
        .popup-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1.1em;
            margin-bottom: 25px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            .popup-modal input,
            .popup-input {
                padding: 12px 18px;
                font-size: 1em;
                margin-bottom: 20px;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-modal input,
            .popup-input {
                padding: 10px 15px;
                font-size: 0.95em;
                margin-bottom: 15px;
                border-radius: 8px;
            }
        }
        
        .popup-modal input:focus,
        .popup-input:focus {
            outline: none;
            border-color: #FF9933;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(255, 153, 51, 0.1), inset 0 2px 4px rgba(0,0,0,0.05);
            transform: translateY(-1px);
        }
        
        .popup-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .popup-buttons {
                gap: 15px;
                margin-top: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-buttons {
                flex-direction: column;
                gap: 10px;
                margin-top: 10px;
                width: 100%;
            }
        }
        
        .popup-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.05em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 120px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .popup-btn {
                padding: 12px 25px;
                font-size: 1em;
                min-width: 100px;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .popup-btn {
                padding: 12px 20px;
                font-size: 0.95em;
                min-width: auto;
                width: 100%;
                border-radius: 8px;
                letter-spacing: 0.3px;
            }
        }
        
        .popup-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .popup-btn:hover::before {
            left: 100%;
        }
        
        .popup-btn.confirm {
            background: linear-gradient(135deg, #FF9933 0%, #FF6B35 50%, #E8751A 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 153, 51, 0.3);
        }
        
        .popup-btn.confirm:hover {
            background: linear-gradient(135deg, #FF8C1A 0%, #FF5722 50%, #D84315 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 153, 51, 0.4);
        }
        
        .popup-btn.confirm:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);
        }
        
        .popup-btn.cancel {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 50%, #495057 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.2);
        }
        
        .popup-btn.cancel:hover {
            background: linear-gradient(135deg, #5a6268 0%, #495057 50%, #343a40 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        .popup-btn.cancel:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.2);
        }
        
        .popup-btn.ok {
            background: #28a745;
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            border-radius: 12px;
            padding: 14px 50px;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .popup-btn.ok:hover {
            background: #218838;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }
        
        .popup-btn.ok:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-tab {
                min-width: auto;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .invoice-item {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
                gap: 8px;
            }
            
            table {
                font-size: 0.85em;
            }
            
            th, td {
                white-space: nowrap;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .header p {
                font-size: 0.9em;
            }
            
            .btn {
                padding: 12px 18px;
                font-size: 0.9em;
                min-width: 100px;
            }
            
            .action-buttons .btn {
                width: 100%;
                min-width: auto;
            }
            
            img, canvas {
                max-width: 100%;
                height: auto;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            animation: slideInRight 0.4s ease-out;
            max-width: 400px;
            border-left: 4px solid #138808;
        }
        
        @media (max-width: 768px) {
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
                padding: 12px 20px;
                font-size: 0.95em;
            }
        }
        
        @media (max-width: 480px) {
            .notification {
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }
        
        /* Dashboard Header Responsive */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
        }
        
        .dashboard-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 480px) {
            .dashboard-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .dashboard-buttons .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        .notification.success {
            border-left-color: #138808;
        }
        
        .notification.error {
            border-left-color: #dc3545;
        }
        
        .notification.warning {
            border-left-color: #ff9933;
        }
        
        .notification-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 3px;
            color: #2c3e50;
        }
        
        .notification-message {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .notification-close {
            background: none;
            border: none;
            font-size: 1.3em;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .notification-close:hover {
            background: #f8f9fa;
            color: #2c3e50;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Logout Button Styles */
        .logout-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
        }
        
        @media (max-width: 768px) {
            .logout-container {
                position: static;
                justify-content: center;
                margin-top: 15px;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .logout-container {
                flex-direction: column;
                gap: 8px;
                margin-top: 10px;
            }
        }
        
        .user-email {
            color: #138808;
            font-weight: 600;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        @media (max-width: 768px) {
            .user-email {
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            .user-email {
                font-size: 0.85em;
            }
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.95em;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
        
        @media (max-width: 768px) {
            .logout-btn {
                padding: 10px 18px;
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            .logout-btn {
                padding: 10px 16px;
                font-size: 0.85em;
                width: 100%;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        .notification.hiding {
            animation: slideOutRight 0.4s ease-out forwards;
        }
        
        /* Dashboard Header Responsive */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .dashboard-header h2 {
                text-align: center;
            }
        }
        
        .dashboard-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 480px) {
            .dashboard-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .dashboard-buttons .btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Form Grid Responsive */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
        }
        
        @media (max-width: 1024px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .form-grid {
                gap: 12px;
            }
        }
        
        /* Customer Form Responsive */
        .customer-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 768px) {
            .customer-form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* Invoice Items Grid Responsive */
        .invoice-items-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 20px;
            align-items: end;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px dashed #138808;
        }
        
        @media (max-width: 1024px) {
            .invoice-items-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .invoice-items-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .invoice-items-grid {
                padding: 15px;
                gap: 10px;
            }
        }
        
        /* Invoice Options Grid */
        .invoice-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .invoice-options-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* QR Code Modal Styles */
        .qr-code-modal {
            max-width: 450px !important;
        }
        
        @media (max-width: 768px) {
            .qr-code-modal {
                max-width: 400px !important;
            }
            
            .qr-code-modal #qrCodeImage {
                max-width: 250px !important;
            }
        }
        
        @media (max-width: 480px) {
            .qr-code-modal {
                max-width: calc(100% - 30px) !important;
            }
            
            .qr-code-modal #qrCodeImage {
                max-width: 220px !important;
            }
            
            .qr-code-modal #qrItemInfo {
                font-size: 1.1em !important;
            }
        }
        
        /* Action Buttons in Tables */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                gap: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .action-buttons {
                flex-direction: column;
                gap: 5px;
                width: 100%;
            }
            
            .action-buttons .btn,
            .action-buttons .btn-icon {
                width: 100%;
                font-size: 0.85em;
                padding: 8px;
            }
        }
        
        /* Loading and Empty States */
        .loading, .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        @media (max-width: 768px) {
            .loading, .empty-state {
                padding: 30px 15px;
                font-size: 0.95em;
            }
        }
        
        @media (max-width: 480px) {
            .loading, .empty-state {
                padding: 25px 10px;
                font-size: 0.9em;
            }
        }
        
        /* Search Bar Responsive Enhancement */
        @media (max-width: 480px) {
            .search-bar {
                flex-direction: column;
            }
            
            .search-bar button {
                width: 100%;
            }
        }
        
        /* Item Cards Styles */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .items-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .items-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        
        .item-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #138808, #28a745);
        }
        
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(19, 136, 8, 0.2);
            border-color: #138808;
        }
        
        .item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .item-card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
            flex: 1;
        }
        
        @media (max-width: 480px) {
            .item-card-title {
                font-size: 1.1em;
            }
        }
        
        .item-card-qr-btn {
            background: linear-gradient(135deg, #138808 0%, #28a745 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }
        
        .item-card-qr-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(19, 136, 8, 0.4);
        }
        
        .item-card-body {
            margin-bottom: 15px;
        }
        
        .item-card-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .item-card-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 600;
        }
        
        .item-card-value {
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .item-price {
            color: #138808;
            font-size: 1.3em;
        }
        
        .item-stock {
            padding: 6px 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1em;
        }
        
        .item-stock.high {
            background: #d4edda;
            color: #155724;
        }
        
        .item-stock.medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .item-stock.low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .item-unit {
            padding: 6px 12px;
            background: #e9ecef;
            border-radius: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .item-card-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        @media (max-width: 480px) {
            .item-card-actions {
                grid-template-columns: 1fr;
            }
        }
        
        .item-card-actions .btn {
            padding: 10px 8px;
            font-size: 0.9em;
            white-space: nowrap;
        }
        
        @media (max-width: 480px) {
            .item-card-actions .btn {
                width: 100%;
                font-size: 0.95em;
            }
        }
        
        /* Customer Cards Styles */
        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .customers-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .customers-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        
        .customer-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .customer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff9933, #138808);
        }
        
        .customer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 153, 51, 0.2);
            border-color: #ff9933;
        }
        
        .customer-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .customer-card-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
            flex: 1;
        }
        
        @media (max-width: 480px) {
            .customer-card-name {
                font-size: 1.1em;
            }
        }
        
        .customer-card-icon {
            font-size: 2em;
            opacity: 0.7;
        }
        
        .customer-card-body {
            margin-bottom: 15px;
        }
        
        .customer-card-info {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .customer-card-info:last-of-type {
            border-bottom: none;
        }
        
        .customer-card-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 600;
            min-width: 90px;
            flex-shrink: 0;
        }
        
        .customer-card-value {
            font-size: 1em;
            font-weight: 500;
            color: #2c3e50;
            word-break: break-word;
        }
        
        .customer-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
            margin-top: 15px;
        }
        
        .customer-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 480px) {
            .customer-stats {
                gap: 10px;
                width: 100%;
            }
        }
        
        .customer-stat {
            text-align: center;
        }
        
        .customer-stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #138808;
            display: block;
        }
        
        .customer-stat-label {
            font-size: 0.85em;
            color: #6c757d;
            display: block;
        }
        
        .customer-card-actions {
            display: flex;
            gap: 8px;
        }
        
        @media (max-width: 480px) {
            .customer-card-footer {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .customer-card-actions {
                width: 100%;
                justify-content: stretch;
            }
            
            .customer-card-actions .btn-icon {
                flex: 1;
            }
        }
        
        /* Invoice Cards Styles */
        .invoices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .invoices-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .invoices-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        
        .invoice-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .invoice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #138808, #ff9933);
        }
        
        .invoice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(19, 136, 8, 0.2);
            border-color: #138808;
        }
        
        .invoice-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .invoice-card-id {
            font-size: 1.4em;
            font-weight: bold;
            color: #138808;
            margin: 0;
        }
        
        @media (max-width: 480px) {
            .invoice-card-id {
                font-size: 1.2em;
            }
        }
        
        .invoice-card-date {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 600;
        }
        
        .invoice-card-body {
            margin-bottom: 15px;
        }
        
        .invoice-card-customer {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (max-width: 480px) {
            .invoice-card-customer {
                font-size: 1.05em;
            }
        }
        
        .invoice-card-total {
            background: linear-gradient(135deg, #138808 0%, #28a745 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(19, 136, 8, 0.2);
        }
        
        .invoice-card-total-label {
            font-size: 0.85em;
            opacity: 0.9;
            display: block;
            margin-bottom: 5px;
        }
        
        .invoice-card-total-value {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
        }
        
        @media (max-width: 480px) {
            .invoice-card-total-value {
                font-size: 1.5em;
            }
        }
        
        .invoice-card-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        @media (max-width: 480px) {
            .invoice-card-actions {
                grid-template-columns: 1fr;
            }
        }
        
        .invoice-card-actions .btn {
            padding: 12px 8px;
            font-size: 0.95em;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        @media (max-width: 480px) {
            .invoice-card-actions .btn {
                width: 100%;
                font-size: 1em;
            }
        }
        
        /* Invoice Summary Responsive */
        .invoice-summary {
            background: #34495e;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .invoice-summary {
                padding: 15px;
            }
            
            .invoice-summary .row {
                flex-direction: column;
                gap: 5px;
                text-align: left;
            }
        }
        
        @media (max-width: 480px) {
            .invoice-summary {
                padding: 12px;
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 768px) {
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="mainHeader">
            <div class="logo-container">
                <br>
                <div>
                    <h1>Invoice Management System</h1>
                    <p id="shopNameHeader">Loading...</p>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard', this)">ðŸ“Š Dashboard</button>
            <button class="nav-tab" onclick="showTab('items', this)">ðŸ“¦ Items</button>
            <button class="nav-tab" onclick="showTab('customers', this)">ðŸ‘¥ Customers</button>
            <button class="nav-tab" onclick="showTab('invoice', this)">ðŸ§¾ Create Invoice</button>
            <button class="nav-tab" onclick="showTab('invoices', this)">ðŸ“‹ View Invoices</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-header">
                <h2 style="margin: 0; color: #138808;" >ðŸ“Š Business Overview</h2>
                <div class="dashboard-buttons">
                    <button onclick="printAllQRCodes()" class="btn btn-success" style="display: inline-flex !important; align-items: center; gap: 8px; visibility: visible !important;">
                        ðŸ–¨ï¸ Print All QR Codes
                    </button>
                    <button onclick="exportAllData()" class="btn btn-primary" style="display: inline-flex !important; align-items: center; gap: 8px; visibility: visible !important;">
                        ðŸ“¥ Export All Data
                    </button>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalInvoices">-</h3>
                    <p>Total Invoices</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalRevenue">-</h3>
                    <p>Total Revenue</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalItems">-</h3>
                    <p>Items in Stock</p>
                </div>
                <div class="stat-card" style="cursor: pointer;" onclick="showLowStockItems()">
                    <h3 id="lowStockItems" style="color: #dc3545;">-</h3>
                    <p>âš ï¸ Low Stock Alert</p>
                </div>
            </div>

            <div class="card">
                <h2>ðŸ“ˆ Top Customers</h2>
                <div id="topCustomers" class="loading">Loading...</div>
            </div>

            <div class="card">
                <h2>ðŸ“… Recent Sales</h2>
                <div id="recentSales" class="loading">Loading...</div>
            </div>
        </div>

        <!-- Items Tab -->
        <div id="items" class="tab-content">
            <div class="card">
                <h2>âž• Add New Item</h2>
                <form id="addItemForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ðŸ“¦ Item Name</label>
                            <input type="text" id="itemName" placeholder="Enter item name" required>
                        </div>
                        <div class="form-group">
                            <label>ðŸ’° Price (â‚¹)</label>
                            <input type="number" step="0.01" id="itemPrice" placeholder="Enter price in rupees" required>
                        </div>
                        <div class="form-group">
                            <label>ðŸ“Š Stock Quantity</label>
                            <input type="number" id="itemStock" placeholder="Enter stock quantity" required>
                        </div>
                        <div class="form-group">
                            <label>ðŸ“ Unit</label>
                            <select id="itemUnit" required style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1.1em; background: #f8f9fa;">
                                <option value="">Select Unit</option>
                                <option value="kg">Kilogram (kg)</option>
                                <option value="gm">Gram (gm)</option>
                                <option value="l">Liter (l)</option>
                                <option value="ml">Milliliter (ml)</option>
                                <option value="pcs">Pieces (pcs)</option>
                                <option value="pack">Pack</option>
                                <option value="box">Box</option>
                                <option value="bottle">Bottle</option>
                                <option value="bag">Bag</option>
                                <option value="dozen">Dozen</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Add Item</button>
                </form>
            </div>

            <div class="card">
                <h2>ðŸ“¦ Inventory Management</h2>
                <div class="search-bar">
                    <input type="text" id="itemSearch" placeholder="Search items...">
                    <button onclick="searchItems()" class="btn btn-primary">Search</button>
                    <button onclick="loadItems()" class="btn btn-warning">Show All</button>
                </div>
                <div id="itemsTable" class="loading">Loading items...</div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div class="card">
                <h2>âž• Add New Customer</h2>
                <form id="addCustomerForm">
                    <div class="customer-form-grid">
                        <div class="form-group">
                            <label>ðŸ‘¤ Customer Name</label>
                            <input type="text" id="newCustomerName" placeholder="Enter full name" required>
                        </div>
                        <div class="form-group">
                            <label>ðŸ“± Phone Number</label>
                            <input type="tel" id="newCustomerPhone" placeholder="+91 XXXXX XXXXX" required>
                        </div>
                    </div>
                    <div class="customer-form-grid">
                        <div class="form-group">
                            <label>ðŸ“§ Email</label>
                            <input type="email" id="newCustomerEmail" placeholder="customer@example.com" required>
                        </div>
                        <div class="form-group">
                            <label>ðŸ  Address</label>
                            <textarea id="newCustomerAddress" rows="1" placeholder="Enter complete address" required style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1.1em; background: #f8f9fa; resize: vertical;"></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Add Customer</button>
                </form>
            </div>

            <div class="card">
                <h2>ðŸ‘¥ Customer Directory</h2>
                <div class="search-bar">
                    <input type="text" id="customerSearch" placeholder="Search customers by name or phone...">
                    <button onclick="searchCustomers()" class="btn btn-primary">Search</button>
                    <button onclick="loadCustomers()" class="btn btn-warning">Show All</button>
                </div>
                <div id="customersTable" class="loading">Loading customers...</div>
            </div>
        </div>

        <!-- Create Invoice Tab -->
        <div id="invoice" class="tab-content">
            <div class="card">
                <h2>ðŸ‘¤ Customer Information</h2>
                
                <!-- Customer Selection Dropdown -->
                <div class="form-group" style="margin-bottom: 25px;">
                    <label style="font-size: 1.1em; font-weight: bold;">ðŸ” Select Existing Customer</label>
                    <select id="customerSelect" style="padding: 15px; border: 2px solid #138808; border-radius: 10px; font-size: 1.1em; background: #f8f9fa; width: 100%;">
                        <option value="">-- Select a customer or enter new details below --</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin: 20px 0; color: #666; font-weight: bold;">
                    OR Enter New Customer Details
                </div>
                
                <div class="customer-form-grid">
                    <div class="form-group">
                        <label>ðŸ‘¤ Customer Name</label>
                        <input type="text" id="customerName" placeholder="Enter customer full name" required>
                    </div>
                    <div class="form-group">
                        <label>ðŸ“± Customer Phone</label>
                        <input type="tel" id="customerPhone" placeholder="+91 XXXXX XXXXX" pattern="[+][0-9]{2}[0-9]{5}[0-9]{5}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>ðŸ“§ Customer Email</label>
                    <input type="email" id="customerEmail" placeholder="customer@example.com (for sending invoice)">
                </div>
                <div class="form-group">
                    <label>ðŸ  Customer Address</label>
                    <textarea id="customerAddress" rows="3" placeholder="Enter complete address with city and state" required></textarea>
                </div>
            </div>

            <div class="card">
                <h2>ðŸ›’ Add Items to Invoice</h2>
                
                <!-- QR Scanner Button -->
                <div style="margin-bottom: 20px; text-align: center;">
                    <button onclick="openQRScanner()" class="btn btn-success" style="font-size: 1.2em; padding: 15px 30px;">
                        ðŸ“· Scan Item QR Code
                    </button>
                    <p style="color: #666; margin-top: 10px; font-size: 0.9em;">Or manually select item below</p>
                </div>
                
                <div class="invoice-items-grid">
                    <div class="form-group">
                        <label>ðŸ›ï¸ Select Item</label>
                        <select id="invoiceItemSelect" style="background: #ffffff; border: 2px solid #138808;">
                            <option value="">Choose an item...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ðŸ”¢ Quantity</label>
                        <input type="number" id="invoiceQuantity" min="1" value="1" style="text-align: center; font-weight: bold; border: 2px solid #138808;">
                    </div>
                    <div class="form-group">
                        <label>ðŸ“¦ Available Stock</label>
                        <input type="number" id="availableStock" readonly style="background: #f8f9fa; text-align: center; font-weight: bold; border: 2px solid #6c757d;">
                    </div>
                    <div class="form-group">
                        <button onclick="addItemToInvoice()" class="btn btn-success" style="padding: 16px 24px; font-size: 1.2em;">âž• Add Item</button>
                    </div>
                </div>

                <div class="invoice-items">
                    <h3>Invoice Items</h3>
                    <div id="invoiceItemsList"></div>
                </div>

                <div id="invoiceSummary" class="invoice-summary" style="display: none;">
                    <div class="row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rs. 0.00</span>
                    </div>
                    <div class="row">
                        <label for="taxRate" style="display:flex; gap:8px; align-items:center; width:100%;">
                            <span>Tax (%)</span>
                            <input type="number" id="taxRate" value="0" min="0" step="0.01" style="width:120px; text-align:right; border:2px solid #138808; border-radius:8px; padding:6px 10px; font-weight:bold;">
                        </label>
                        <span id="tax">Rs. 0.00</span>
                    </div>
                    <div class="row">
                        <label for="discountRate" style="display:flex; gap:8px; align-items:center; width:100%;">
                            <span>Discount (%)</span>
                            <input type="number" id="discountRate" value="0" min="0" step="0.01" style="width:120px; text-align:right; border:2px solid #dc3545; border-radius:8px; padding:6px 10px; font-weight:bold;">
                        </label>
                        <span id="discount">Rs. 0.00</span>
                    </div>
                    <div class="row total">
                        <span>Total:</span>
                        <span id="total">Rs. 0.00</span>
                    </div>
                </div>

                <div style="background: #e7f3ff; padding: 20px; border-radius: 10px; border: 2px solid #007bff; margin-top: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="sendEmailCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-size: 1.1em; font-weight: 600; color: #007bff;">ðŸ“§ Send invoice to customer's email</span>
                    </label>
                    <p style="margin: 10px 0 0 30px; color: #666; font-size: 0.9em;">
                        âœ‰ï¸ Customer will receive a detailed invoice via email
                    </p>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label>ðŸ“ Additional Notes (Optional)</label>
                    <textarea id="invoiceNotes" rows="2" placeholder="Add any special instructions or notes for this invoice..." style="padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1em; background: #f8f9fa; resize: vertical; width: 100%;"></textarea>
                </div>

                <button onclick="generateInvoice()" class="btn btn-primary" style="margin-top: 20px;" disabled id="generateBtn">Generate Invoice</button>
            </div>
        </div>

        <!-- View Invoices Tab -->
        <div id="invoices" class="tab-content">
            <div class="card">
                <h2>ðŸ“‹ All Invoices</h2>
                <div class="search-bar">
                    <input type="text" id="invoiceSearch" placeholder="Search by customer name or invoice ID...">
                    <button onclick="searchInvoices()" class="btn btn-primary">Search</button>
                    <button onclick="loadInvoices()" class="btn btn-warning">Show All</button>
                </div>
                <div id="invoicesTable" class="loading">Loading invoices...</div>
            </div>
        </div>

        <!-- Alert container -->
        <div id="alertContainer"></div>
    </div>

    <!-- Custom Popup Modal -->
    <div id="popupOverlay" class="popup-overlay">
        <div class="popup-modal">
            <h3 id="popupTitle">Confirmation</h3>
            <p id="popupMessage">Are you sure?</p>
            <div class="popup-buttons" id="popupButtons">
                <button class="popup-btn cancel" onclick="hidePopup()">Cancel</button>
                <button class="popup-btn confirm" onclick="confirmAction()">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- QR Code Display Modal -->
    <div id="qrModal" class="popup-overlay" style="display:none;">
        <div class="popup-modal qr-code-modal" style="max-width: 450px; background: white !important; padding: 0; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #FF9933 0%, #FF7A00 100%); padding: 20px; text-align: center;">
                <h3 style="color: white; margin: 0; font-size: 1.4em; text-shadow: none;">
                    ðŸ“± Item QR Code
                </h3>
            </div>
            <div id="qrModalContent" style="text-align: center; padding: 30px 20px; background: white;">
                <div style="background: white; border: 4px solid #28a745; border-radius: 12px; padding: 15px; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <img id="qrCodeImage" src="" alt="QR Code" style="max-width: 280px; width: 100%; display: block; background: white;">
                </div>
                <p id="qrItemInfo" style="margin-top: 20px; font-weight: bold; color: #28a745; font-size: 1.2em;"></p>
                <p style="color: #666; margin-top: 10px; font-size: 0.95em;">Scan this QR code to quickly add<br>item to invoice</p>
            </div>
            <div class="popup-buttons" style="padding: 0 20px 25px 20px;">
                <button class="popup-btn ok" onclick="printQR()" style="flex: 1;">ðŸ–¨ï¸ Print QR</button>
                <button class="popup-btn cancel" onclick="closeQRModal()" style="flex: 1;">Close</button>
            </div>
        </div>
    </div>

    <!-- Print All QR Codes Modal -->
    <div id="printQRModal" class="popup-overlay" style="display:none; background: rgba(0,0,0,0.95);">
        <div style="width: 100%; height: 100vh; overflow-y: auto; background: white; position: relative;">
            <div id="printQRContent" style="width: 100%; height: 100%;"></div>
            <div class="no-print" style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: white; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border-radius: 10px;">
                <button onclick="window.print()" style="padding: 12px 30px; background: #138808; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-right: 10px;">ðŸ–¨ï¸ Print All</button>
                <button onclick="closePrintQRModal()" style="padding: 12px 30px; background: #dc3545; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">âœ– Close</button>
            </div>
        </div>
    </div>
    
    <!-- QR Scanner Modal -->
    <div id="qrScannerModal" class="popup-overlay" style="display:none;">
        <div class="popup-modal" style="max-width: 600px;">
            <h3>ðŸ“· Scan Item QR Code</h3>
            <div style="padding: 20px;">
                <video id="qrVideo" style="width: 100%; max-width: 500px; border: 3px solid #138808; border-radius: 10px;"></video>
                <canvas id="qrCanvas" style="display:none;"></canvas>
                <p style="margin-top: 15px; text-align: center; color: #666;">Position the QR code within the camera frame</p>
            </div>
            <div class="popup-buttons">
                <button class="popup-btn cancel" onclick="closeQRScanner()">Close Scanner</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"></script>
    <script>
        // Backend URL - Always use Render production server
        // const API_BASE = 'https://invoice-system-vpmz.onrender.com';
        const API_BASE = 'http://localhost:5000';
        console.log('API Base URL:', API_BASE);
        let currentItems = [];
        let invoiceItems = [];
        let popupCallback = null;
        
        // EmailJS Configuration - Fetched from backend
        let EMAILJS_CONFIG = {
            service_id: '',
            template_id: '',
            public_key: '',
            configured: false
        };
        
        // Fetch EmailJS configuration from backend
        async function loadEmailJSConfig() {
            try {
                const response = await fetch(`${API_BASE}/api/emailjs-config`);
                if (response.ok) {
                    EMAILJS_CONFIG = await response.json();
                    if (EMAILJS_CONFIG.configured) {
                        console.log('âœ… EmailJS configuration loaded from backend');
                        // Initialize EmailJS with public key
                        if (typeof emailjs !== 'undefined' && EMAILJS_CONFIG.public_key) {
                            emailjs.init(EMAILJS_CONFIG.public_key);
                        }
                    } else {
                        console.warn('âš ï¸ EmailJS not configured on backend');
                    }
                } else {
                    console.error('Failed to fetch EmailJS config');
                }
            } catch (error) {
                console.error('Error loading EmailJS config:', error);
            }
        }
        
        // Load EmailJS config on page load
        loadEmailJSConfig();
        
        // Helper function to send email via EmailJS (for invoices and OTP)
        async function sendEmailViaEmailJS(toEmail, htmlCode) {
            try {
                if (!EMAILJS_CONFIG.configured) {
                    throw new Error('EmailJS not configured on backend');
                }
                
                const emailData = {
                    service_id: EMAILJS_CONFIG.service_id,
                    template_id: EMAILJS_CONFIG.template_id,
                    user_id: EMAILJS_CONFIG.public_key,
                    template_params: {
                        email: toEmail,
                        HTML_CODE: htmlCode
                    }
                };
                
                const emailResponse = await fetch('https://api.emailjs.com/api/v1.0/email/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData)
                });
                
                if (emailResponse.ok) {
                    console.log('âœ… Email sent successfully to:', toEmail);
                    return true;
                } else {
                    const errorText = await emailResponse.text();
                    console.error('âŒ Email API error:', errorText);
                    throw new Error(errorText);
                }
            } catch (error) {
                console.error('âŒ Email sending failed:', error);
                throw error;
            }
        }
        
        // Helper function to get auth headers
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('session_token')}`
            };
        }
        
        // Helper function to handle auth errors
        function handleAuthError(data) {
            if (data.error && (data.error.includes('Unauthorized') || data.error.includes('login'))) {
                showPopup('Session Expired âš ï¸', 'Your session has expired. Please login again.', 'alert');
                setTimeout(() => {
                    localStorage.clear();
                    window.location.href = 'login.html';
                }, 2000);
                return true;
            }
            return false;
        }
        
        // Health check to wake up Render server
        async function pingServerHealth(showLoading = false) {
            if (showLoading) {
                showNotification('Waking up server...', 'Please wait, connecting to server', 'info');
            }
            
            try {
                console.log('Pinging server to wake it up...');
                
                const response = await fetch(`${API_BASE}/`, {
                    method: 'GET',
                    credentials: 'include',
                    mode: 'cors'
                });
                
                if (response.ok || response.status === 404) {
                    console.log('Server is awake and ready');
                    return true;
                }
                
                // If 502/503/504, wait and try once more
                if ([502, 503, 504].includes(response.status)) {
                    console.log('Server waking up, waiting 3 seconds...');
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    const retryResponse = await fetch(`${API_BASE}/`, {
                        method: 'GET',
                        credentials: 'include',
                        mode: 'cors'
                    });
                    
                    return retryResponse.ok || retryResponse.status === 404;
                }
                
                return true;
            } catch (error) {
                console.warn('Health check failed, but continuing anyway:', error.message);
                // Don't block on health check failure, let the actual request try
                return true;
            }
        }
        
        // Retry helper for handling Render free tier wake-up delays
        async function fetchWithRetry(url, options = {}, maxRetries = 4, retryDelay = 2000) {
            let lastError = null;
            
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const controller = new AbortController();
                    // Longer timeout for invoice creation (90 seconds), normal for others
                    const timeoutMs = url.includes('/api/invoices') && options.method === 'POST' ? 90000 : 30000;
                    const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
                    
                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal,
                        credentials: 'include',
                        mode: 'cors'
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // If 502, 503, or 504 (service waking up or timeout), retry
                    if ([502, 503, 504].includes(response.status) && i < maxRetries - 1) {
                        console.log(`Server waking up (${response.status}), retrying in ${retryDelay}ms... (attempt ${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        continue;
                    }
                    
                    // If CORS error (status 0), retry
                    if (response.status === 0 && i < maxRetries - 1) {
                        console.log(`CORS/Network issue, retrying in ${retryDelay}ms... (attempt ${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        continue;
                    }
                    
                    return response;
                } catch (error) {
                    lastError = error;
                    
                    // If it's an AbortError and not the last retry, try again with even longer timeout
                    if (error.name === 'AbortError' && i < maxRetries - 1) {
                        console.log(`Request timeout, retrying with longer timeout... (attempt ${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        continue;
                    }
                    
                    if (i < maxRetries - 1) {
                        console.log(`Network error (${error.name}), retrying in ${retryDelay}ms... (attempt ${i + 1}/${maxRetries})`);
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        continue;
                    }
                }
            }
            
            // If all retries failed, throw the last error
            throw lastError || new Error('All retry attempts failed');
        }
        
        // Check authentication on page load
        async function checkAuth() {
            const sessionToken = localStorage.getItem('session_token');
            
            if (!sessionToken) {
                console.log('No session token found, redirecting to login');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('Checking authentication with API_BASE:', API_BASE);
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/verify-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ session_token: sessionToken }),
                    credentials: 'include'
                });
                
                console.log('Auth response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Auth response data:', data);
                
                if (!data.success) {
                    console.log('Session invalid, redirecting to login');
                    localStorage.removeItem('session_token');
                    localStorage.removeItem('user_email');
                    window.location.href = 'login.html';
                    return;
                }
                
                // Update UI with user email
                const userEmail = localStorage.getItem('user_email');
                const shopName = localStorage.getItem('shop_name') || data.shop_name || 'Shop';
                const shopAddress = localStorage.getItem('shop_address') || data.shop_address || '';
                const shopPhone = localStorage.getItem('shop_phone') || data.shop_phone || '';
                
                // Update shop name in header
                document.getElementById('shopNameHeader').textContent = `ðŸª ${shopName}`;
                document.title = `ðŸ“‹ ${shopName} - Invoice System`;
                
                // Store shop details if from API
                if (data.shop_name) {
                    localStorage.setItem('shop_name', data.shop_name);
                    localStorage.setItem('shop_address', data.shop_address);
                    localStorage.setItem('shop_phone', data.shop_phone);
                }
                
                if (userEmail) {
                    updateHeaderWithUser(userEmail);
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = 'login.html';
            }
        }
        
        function updateHeaderWithUser(email) {
            const header = document.querySelector('.header');
            const logoutBtn = document.createElement('div');
            logoutBtn.className = 'logout-container';
            logoutBtn.innerHTML = `
                <span class="user-email">ðŸ‘¤ ${email}</span>
                <button onclick="logout()" class="logout-btn">
                    ðŸšª Logout
                </button>
            `;
            header.style.position = 'relative';
            header.appendChild(logoutBtn);
        }
        
        async function logout() {
            const sessionToken = localStorage.getItem('session_token');
            
            try {
                await fetch(`${API_BASE}/api/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ session_token: sessionToken })
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            localStorage.removeItem('session_token');
            localStorage.removeItem('user_email');
            localStorage.removeItem('shop_name');
            localStorage.removeItem('shop_address');
            localStorage.removeItem('shop_phone');
            window.location.href = 'login.html';
        }
        
        // Run auth check immediately
        checkAuth();
        
        // Popup Functions
        function showPopup(title, message, type = 'confirm', callback = null) {
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupMessage').innerHTML = message;
            popupCallback = callback;
            
            const buttonsDiv = document.getElementById('popupButtons');
            if (type === 'confirm') {
                buttonsDiv.innerHTML = `
                    <button class="popup-btn cancel" onclick="hidePopup()">Cancel</button>
                    <button class="popup-btn confirm" onclick="confirmAction()">Confirm</button>
                `;
            } else if (type === 'alert') {
                buttonsDiv.innerHTML = `
                    <button class="popup-btn ok" onclick="hidePopup()">OK</button>
                `;
            }
            
            const overlay = document.getElementById('popupOverlay');
            overlay.style.display = 'flex';
            overlay.classList.add('show');
            
            // Close on click outside modal
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    hidePopup();
                }
            };
            
            // Prevent modal click from closing
            overlay.querySelector('.popup-modal').onclick = function(e) {
                e.stopPropagation();
            };
            
            // Add keyboard support
            document.addEventListener('keydown', handlePopupKeydown);
        }
        
        function hidePopup() {
            const overlay = document.getElementById('popupOverlay');
            overlay.classList.add('hide');
            overlay.classList.remove('show');
            
            setTimeout(() => {
                overlay.style.display = 'none';
                overlay.classList.remove('hide');
                popupCallback = null;
            }, 200);
        }
        
        function confirmAction() {
            if (popupCallback) {
                popupCallback();
            }
            hidePopup();
        }
        
        // Input Popup for prompts
        function showInputPopup(title, message, inputType = 'text', placeholder = '', callback = null) {
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupMessage').innerHTML = `
                <p style="margin-bottom: 20px;">${message}</p>
                <input type="${inputType}" id="popupInput" placeholder="${placeholder}" 
                       class="popup-input"
                       step="0.01" min="0">
            `;
            popupCallback = () => {
                const value = document.getElementById('popupInput').value;
                if (callback) callback(value);
            };
            
            const buttonsDiv = document.getElementById('popupButtons');
            buttonsDiv.innerHTML = `
                <button class="popup-btn cancel" onclick="hidePopup()">Cancel</button>
                <button class="popup-btn confirm" onclick="confirmAction()">Update</button>
            `;
            
            const overlay = document.getElementById('popupOverlay');
            overlay.style.display = 'flex';
            overlay.classList.add('show');
            
            // Close on click outside modal
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    hidePopup();
                }
            };
            
            // Prevent modal click from closing
            overlay.querySelector('.popup-modal').onclick = function(e) {
                e.stopPropagation();
            };
            
            // Add keyboard support
            document.addEventListener('keydown', handlePopupKeydown);
            
            // Focus on input and select text
            setTimeout(() => {
                const input = document.getElementById('popupInput');
                if (input) {
                    input.focus();
                    input.select();
                    
                    // Allow Enter key to confirm
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            confirmAction();
                        }
                    });
                }
            }, 100);
        }
        
        function handlePopupKeydown(e) {
            if (e.key === 'Escape' && document.getElementById('popupOverlay').classList.contains('show')) {
                hidePopup();
            }
        }
        
        // Notification System
        function showNotification(title, message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸'
            };
            
            notification.innerHTML = `
                <div class="notification-icon">${iconMap[type] || 'âœ…'}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                notification.classList.add('hiding');
                setTimeout(() => {
                    notification.remove();
                }, 400);
            }, 4000);
        }

        // Utility functions
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        // Tab management
        function showTab(tabName, element = null) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            if (element) {
                element.classList.add('active');
            } else if (event && event.target) {
                event.target.classList.add('active');
            }

            // Load data based on tab
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'items') {
                loadItems();
                loadItemsForInvoice();
            } else if (tabName === 'customers') {
                loadCustomers();
            } else if (tabName === 'invoice') {
                loadCustomersForInvoice();
                loadItemsForInvoice();
                clearInvoiceForm();
            } else if (tabName === 'invoices') {
                loadInvoices();
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            console.log('Loading dashboard data...');
            try {
                const [statsResponse, itemsResponse] = await Promise.all([
                    fetch(`${API_BASE}/api/stats`, { 
                        headers: getAuthHeaders(),
                        credentials: 'include'
                    }),
                    fetch(`${API_BASE}/api/items`, { 
                        headers: getAuthHeaders(),
                        credentials: 'include'
                    })
                ]);

                console.log('Stats response status:', statsResponse.status);
                console.log('Items response status:', itemsResponse.status);

                if (!statsResponse.ok || !itemsResponse.ok) {
                    throw new Error('Failed to fetch dashboard data');
                }

                const statsData = await statsResponse.json();
                const itemsData = await itemsResponse.json();

                console.log('Stats data:', statsData);
                console.log('Items data:', itemsData);

                if (handleAuthError(statsData) || handleAuthError(itemsData)) return;

                if (statsData.success) {
                    const stats = statsData.stats;
                    document.getElementById('totalInvoices').textContent = stats.total_invoices;
                    document.getElementById('totalRevenue').textContent = formatCurrency(stats.total_revenue);

                    // Top customers
                    const topCustomersDiv = document.getElementById('topCustomers');
                    if (stats.top_customers.length > 0) {
                        topCustomersDiv.innerHTML = stats.top_customers.map(customer => 
                            `<div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee;">
                                <span>${customer._id}</span>
                                <span>${formatCurrency(customer.total_spent)} (${customer.invoice_count} invoices)</span>
                            </div>`
                        ).join('');
                    } else {
                        topCustomersDiv.innerHTML = '<div class="empty-state"><h3>No customers yet</h3><p>Create your first invoice to see top customers</p></div>';
                    }

                    // Recent sales
                    const recentSalesDiv = document.getElementById('recentSales');
                    if (stats.daily_sales.length > 0) {
                        recentSalesDiv.innerHTML = stats.daily_sales.map(sale => 
                            `<div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee;">
                                <span>${formatDate(sale._id)}</span>
                                <span>${formatCurrency(sale.daily_sales)}</span>
                            </div>`
                        ).join('');
                    } else {
                        recentSalesDiv.innerHTML = '<div class="empty-state"><h3>No sales data</h3><p>Create invoices to see sales trends</p></div>';
                    }
                }

                if (itemsData.success) {
                    document.getElementById('totalItems').textContent = itemsData.items.length;
                    
                    // Calculate low stock items (stock <= 10)
                    const lowStockCount = itemsData.items.filter(item => item.stock <= 10).length;
                    document.getElementById('lowStockItems').textContent = lowStockCount;
                    
                    // Store low stock items for later use
                    window.lowStockItems = itemsData.items.filter(item => item.stock <= 10);
                }

            } catch (error) {
                console.error('Error loading dashboard:', error);
                console.error('Error stack:', error.stack);
                console.error('API Base URL:', API_BASE);
                
                // Set error state in UI
                document.getElementById('totalInvoices').textContent = 'Error';
                document.getElementById('totalRevenue').textContent = 'Error';
                document.getElementById('totalItems').textContent = 'Error';
                document.getElementById('lowStockItems').textContent = 'Error';
                
                showNotification('Connection Error', 'Cannot connect to server. Please check if backend is running at ' + API_BASE, 'error');
            }
        }

        function showLowStockItems() {
            if (!window.lowStockItems || window.lowStockItems.length === 0) {
                showPopup('No Low Stock Items âœ…', 'All items have sufficient stock!', 'alert');
                return;
            }
            
            const itemsList = window.lowStockItems
                .map(item => `<div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                    <span><strong>${item.item_name}</strong></span>
                    <span style="color: ${item.stock === 0 ? '#dc3545' : item.stock <= 5 ? '#ffc107' : '#ff9933'}; font-weight: bold;">
                        ${item.stock} ${item.unit || 'pcs'} ${item.stock === 0 ? '(OUT OF STOCK!)' : ''}
                    </span>
                </div>`)
                .join('');
            
            showPopup('âš ï¸ Low Stock Alert', `
                <div style="text-align: left; max-height: 400px; overflow-y: auto;">
                    <p style="margin-bottom: 15px; color: #666;">The following items need restocking:</p>
                    ${itemsList}
                </div>
            `, 'alert');
        }

        async function exportAllData() {
            try {
                showNotification('Exporting...', 'Preparing your shop data for export', 'info');
                
                const response = await fetch(`${API_BASE}/api/export/all-data`, {
                    headers: getAuthHeaders()
                });
                
                const result = await response.json();
                
                if (handleAuthError(result)) return;
                
                if (result.success) {
                    const data = result.data;
                    
                    // Create a formatted JSON string
                    const jsonString = JSON.stringify(data, null, 2);
                    
                    // Create blob and download
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    // Generate filename with shop name and date
                    const shopName = data.shop_info.shop_name.replace(/[^a-z0-9]/gi, '_');
                    const date = new Date().toISOString().split('T')[0];
                    a.download = `${shopName}_Complete_Data_${date}.json`;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    // Show success with summary
                    const summary = `
                        <div style="text-align: left; line-height: 1.8;">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <strong style="font-size: 1.3em; color: #138808;">âœ… Data Export Completed Successfully!</strong>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 12px; border-left: 5px solid #138808; margin-bottom: 15px;">
                                <strong style="color: #138808; font-size: 1.1em;">ðŸ“Š Export Summary</strong>
                                <div style="margin-top: 15px; font-size: 1.05em;">
                                    <div style="padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                        ðŸ“¦ <strong>Total Items:</strong> <span style="color: #138808; font-weight: bold;">${data.summary.total_items}</span> items in inventory
                                    </div>
                                    <div style="padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                        ðŸ’° <strong>Stock Value:</strong> <span style="color: #138808; font-weight: bold;">${formatCurrency(data.summary.total_stock_value)}</span>
                                    </div>
                                    <div style="padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                        ðŸ‘¥ <strong>Total Customers:</strong> <span style="color: #138808; font-weight: bold;">${data.summary.total_customers}</span> registered customers
                                    </div>
                                    <div style="padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                        ðŸ§¾ <strong>Total Invoices:</strong> <span style="color: #138808; font-weight: bold;">${data.summary.total_invoices}</span> invoices generated
                                    </div>
                                    <div style="padding: 8px 0;">
                                        ðŸ’µ <strong>Total Revenue:</strong> <span style="color: #138808; font-weight: bold; font-size: 1.15em;">${formatCurrency(data.summary.total_revenue)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #e7f3ff; padding: 15px; border-radius: 10px; border-left: 5px solid #007bff; margin-bottom: 15px;">
                                <strong style="color: #007bff; font-size: 1.05em;">ðŸ“ Downloaded File</strong>
                                <div style="margin-top: 10px; background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #007bff;">
                                    <code style="color: #333; font-size: 0.95em; word-break: break-all;">${shopName}_Complete_Data_${date}.json</code>
                                </div>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border-left: 5px solid #ffc107;">
                                <p style="color: #856404; font-size: 0.95em; margin: 0; line-height: 1.6;">
                                    <strong>â„¹ï¸ About This Export:</strong><br>
                                    Your complete shop data has been successfully exported as a JSON file. This file contains all your items, customers, and invoice records. You can use this export for data backup, analysis, reporting, or migration to other systems.
                                </p>
                            </div>
                        </div>
                    `;
                    
                    showPopup('Data Export Complete! ðŸ“¥', summary, 'alert');
                } else {
                    showPopup('Export Failed âŒ', 'Error exporting data: ' + result.error, 'alert');
                }
            } catch (error) {
                console.error('Error exporting data:', error);
                showPopup('Export Failed âŒ', 'Failed to export shop data. Please try again.', 'alert');
            }
        }

        // Items functions
        async function loadItems() {
            try {
                const response = await fetch(`${API_BASE}/api/items`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                if (data.success) {
                    currentItems = data.items;
                    displayItems(data.items);
                } else {
                    showPopup('Error âŒ', 'Error loading items: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error loading items:', error);
                showPopup('Error âŒ', 'Failed to load items. Please refresh the page.', 'alert');
            }
        }

        function displayItems(items) {
            const itemsTable = document.getElementById('itemsTable');
            
            if (items.length === 0) {
                itemsTable.innerHTML = '<div class="empty-state"><h3>No items found</h3><p>Add some items to your inventory</p></div>';
                return;
            }

            itemsTable.innerHTML = `
                <div class="items-grid">
                    ${items.map(item => {
                        const stockClass = item.stock > 10 ? 'high' : item.stock > 0 ? 'medium' : 'low';
                        return `
                            <div class="item-card">
                                <div class="item-card-header">
                                    <h3 class="item-card-title">ðŸ“¦ ${item.item_name}</h3>
                                    <button onclick="showItemQR('${item._id}')" class="item-card-qr-btn" title="Show QR Code">ðŸ“±</button>
                                </div>
                                <div class="item-card-body">
                                    <div class="item-card-info">
                                        <span class="item-card-label">ðŸ’° Price</span>
                                        <span class="item-card-value item-price">â‚¹${item.item_price.toFixed(2)}</span>
                                    </div>
                                    <div class="item-card-info">
                                        <span class="item-card-label">ðŸ“¦ Stock</span>
                                        <span class="item-stock ${stockClass}">${item.stock}</span>
                                    </div>
                                    <div class="item-card-info">
                                        <span class="item-card-label">ðŸ“ Unit</span>
                                        <span class="item-unit">${item.unit || '-'}</span>
                                    </div>
                                </div>
                                <div class="item-card-actions">
                                    <button onclick="updateItemStock('${item._id}', '${item.item_name}')" class="btn btn-warning" title="Update Stock">ðŸ“¦ Stock</button>
                                    <button onclick="updateItemPrice('${item._id}', '${item.item_name}')" class="btn btn-primary" title="Update Price">ðŸ’° Price</button>
                                    <button onclick="deleteItem('${item._id}', '${item.item_name}')" class="btn btn-danger" title="Delete Item">ðŸ—‘ï¸ Delete</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        async function searchItems() {
            const searchTerm = document.getElementById('itemSearch').value.trim();
            
            if (!searchTerm) {
                loadItems();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/items/search?q=${encodeURIComponent(searchTerm)}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                if (data.success) {
                    displayItems(data.items);
                } else {
                    showPopup('Error âŒ', 'Error searching items: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error searching items:', error);
                showPopup('Error âŒ', 'Failed to search items. Please try again.', 'alert');
            }
        }

        document.getElementById('addItemForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const itemName = document.getElementById('itemName').value.trim();
            const itemPrice = parseFloat(document.getElementById('itemPrice').value);
            const itemStock = parseInt(document.getElementById('itemStock').value);
            const itemUnit = document.getElementById('itemUnit').value;

            if (!itemName || itemPrice < 0 || itemStock < 0 || !itemUnit) {
                showPopup('Invalid Input âš ï¸', 'Please fill in all fields with valid values. Price and stock must be positive numbers and unit must be selected.', 'alert');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/items`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        item_name: itemName,
                        item_price: itemPrice,
                        stock: itemStock,
                        unit: itemUnit
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Success!', `Item "${itemName}" added successfully to inventory`, 'success');
                    document.getElementById('addItemForm').reset();
                    loadItems();
                    loadItemsForInvoice();
                    
                    // Show QR code if available
                    if (data.qr_code) {
                        setTimeout(() => {
                            showQRCodeModal(data.qr_code, data.item);
                        }, 500);
                    }
                } else {
                    showPopup('Error âŒ', 'Error adding item: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error adding item:', error);
                showPopup('Error âŒ', 'Failed to add item. Please try again.', 'alert');
            }
        });

        document.getElementById('addCustomerForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const customerName = document.getElementById('newCustomerName').value.trim();
            const customerPhone = document.getElementById('newCustomerPhone').value.trim();
            const customerEmail = document.getElementById('newCustomerEmail').value.trim();
            const customerAddress = document.getElementById('newCustomerAddress').value.trim();

            if (!customerName || !customerPhone || !customerEmail || !customerAddress) {
                showPopup('Invalid Input âš ï¸', 'All customer fields are required: name, phone, email, and address.', 'alert');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/customers`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        customer_name: customerName,
                        customer_phone: customerPhone,
                        customer_email: customerEmail,
                        customer_address: customerAddress
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Success!', `Customer "${customerName}" added successfully`, 'success');
                    document.getElementById('addCustomerForm').reset();
                    loadCustomers();
                } else {
                    showPopup('Error âŒ', 'Error adding customer: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error adding customer:', error);
                showPopup('Error âŒ', 'Failed to add customer. Please try again.', 'alert');
            }
        });

        async function updateItemStock(itemId, itemName) {
            showInputPopup(
                'Update Stock ðŸ“¦',
                `Enter additional stock for "${itemName}":`,
                'number',
                '10',
                (value) => processStockUpdate(itemId, itemName, value)
            );
        }
        
        async function processStockUpdate(itemId, itemName, additionalStock) {
            if (!additionalStock || additionalStock === '') return;

            const stock = parseInt(additionalStock);
            if (isNaN(stock) || stock < 0) {
                showPopup('Invalid Stock âš ï¸', 'Please enter a valid positive stock quantity.', 'alert');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/items/${itemId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        stock: stock,
                        update_type: 'add'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showPopup('Stock Updated! ðŸ“¦', data.message, 'alert');
                    loadItems();
                    loadItemsForInvoice();
                } else {
                    showPopup('Error âŒ', 'Error updating stock: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error updating stock:', error);
                showPopup('Error âŒ', 'Failed to update stock. Please try again.', 'alert');
            }
        }

        async function updateItemPrice(itemId, itemName) {
            showInputPopup(
                'Update Price ðŸ’°',
                `Enter new price for "${itemName}" (â‚¹):`,
                'number',
                '100.00',
                (value) => processPriceUpdate(itemId, itemName, value)
            );
        }
        
        async function processPriceUpdate(itemId, itemName, newPrice) {
            if (!newPrice || newPrice === '') return;

            const price = parseFloat(newPrice);
            if (isNaN(price) || price <= 0) {
                showPopup('Invalid Price âš ï¸', 'Please enter a valid price (must be greater than 0).', 'alert');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/items/${itemId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        item_price: price
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showPopup('Price Updated! ðŸ’°', data.message, 'alert');
                    loadItems();
                    loadItemsForInvoice();
                } else {
                    showPopup('Error âŒ', 'Error updating price: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error updating price:', error);
                showPopup('Error âŒ', 'Failed to update price. Please try again.', 'alert');
            }
        }

        async function deleteItem(itemId, itemName) {
            showPopup(
                'Delete Item? ðŸ—‘ï¸',
                `Are you sure you want to permanently delete "${itemName}" from inventory?\n\nThis action cannot be undone!`,
                'confirm',
                () => processDeleteItem(itemId, itemName)
            );
        }
        
        async function processDeleteItem(itemId, itemName) {

            try {
                const response = await fetch(`${API_BASE}/api/items/${itemId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders(),
                });

                const data = await response.json();

                if (data.success) {
                    showPopup('Deleted! ðŸ—‘ï¸', data.message, 'alert');
                    loadItems();
                    loadItemsForInvoice();
                } else {
                    showPopup('Error âŒ', 'Error deleting item: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                showPopup('Error âŒ', 'Failed to delete item. Please try again.', 'alert');
            }
        }

        // Customer Management Functions
        async function loadCustomers() {
            try {
                const response = await fetch(`${API_BASE}/api/customers`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                const customersTable = document.getElementById('customersTable');

                if (data.success && data.customers.length > 0) {
                    const customers = data.customers;
                    customersTable.innerHTML = `
                        <div class="customers-grid">
                            ${customers.map(customer => `
                                <div class="customer-card">
                                    <div class="customer-card-header">
                                        <h3 class="customer-card-name">ðŸ‘¤ ${customer.customer_name}</h3>
                                    </div>
                                    <div class="customer-card-body">
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ“± Phone:</span>
                                            <span class="customer-card-value">${customer.customer_phone}</span>
                                        </div>
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ“§ Email:</span>
                                            <span class="customer-card-value">${customer.customer_email || 'Not provided'}</span>
                                        </div>
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ  Address:</span>
                                            <span class="customer-card-value">${customer.customer_address || 'Not provided'}</span>
                                        </div>
                                    </div>
                                    <div class="customer-card-footer">
                                        <div class="customer-stats">
                                            <div class="customer-stat">
                                                <span class="customer-stat-value">${customer.total_purchases || 0}</span>
                                                <span class="customer-stat-label">Purchases</span>
                                            </div>
                                            <div class="customer-stat">
                                                <span class="customer-stat-value">${formatCurrency(customer.total_spent || 0)}</span>
                                                <span class="customer-stat-label">Total Spent</span>
                                            </div>
                                        </div>
                                        <div class="customer-card-actions">
                                            <button onclick="editCustomer('${customer._id}')" class="btn-icon" title="Edit Customer">âœï¸</button>
                                            <button onclick="deleteCustomer('${customer._id}', '${customer.customer_name}')" class="btn-icon" title="Delete Customer">ðŸ—‘ï¸</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    customersTable.innerHTML = `
                        <div class="empty-state">
                            <h3>ðŸ‘¥ No Customers Yet</h3>
                            <p>Add your first customer using the form above</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading customers:', error);
                document.getElementById('customersTable').innerHTML = '<p class="error">Error loading customers. Please try again.</p>';
            }
        }

        async function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.trim();
            if (!searchTerm) {
                loadCustomers();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/customers/search?q=${encodeURIComponent(searchTerm)}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                const customersTable = document.getElementById('customersTable');

                if (data.success && data.customers.length > 0) {
                    const customers = data.customers;
                    customersTable.innerHTML = `
                        <div class="customers-grid">
                            ${customers.map(customer => `
                                <div class="customer-card">
                                    <div class="customer-card-header">
                                        <h3 class="customer-card-name">ðŸ‘¤ ${customer.customer_name}</h3>
                                    </div>
                                    <div class="customer-card-body">
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ“± Phone:</span>
                                            <span class="customer-card-value">${customer.customer_phone}</span>
                                        </div>
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ“§ Email:</span>
                                            <span class="customer-card-value">${customer.customer_email || 'Not provided'}</span>
                                        </div>
                                        <div class="customer-card-info">
                                            <span class="customer-card-label">ðŸ  Address:</span>
                                            <span class="customer-card-value">${customer.customer_address || 'Not provided'}</span>
                                        </div>
                                    </div>
                                    <div class="customer-card-footer">
                                        <div class="customer-stats">
                                            <div class="customer-stat">
                                                <span class="customer-stat-value">${customer.total_purchases || 0}</span>
                                                <span class="customer-stat-label">Purchases</span>
                                            </div>
                                            <div class="customer-stat">
                                                <span class="customer-stat-value">${formatCurrency(customer.total_spent || 0)}</span>
                                                <span class="customer-stat-label">Total Spent</span>
                                            </div>
                                        </div>
                                        <div class="customer-card-actions">
                                            <button onclick="editCustomer('${customer._id}')" class="btn-icon" title="Edit Customer">âœï¸</button>
                                            <button onclick="deleteCustomer('${customer._id}', '${customer.customer_name}')" class="btn-icon" title="Delete Customer">ðŸ—‘ï¸</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    customersTable.innerHTML = `
                        <div class="empty-state">
                            <h3>ðŸ” No Customers Found</h3>
                            <p>No customers match your search: "${searchTerm}"</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error searching customers:', error);
                showPopup('Error âŒ', 'Failed to search customers. Please try again.', 'alert');
            }
        }

        async function editCustomer(customerId) {
            try {
                // Fetch customer data first
                const response = await fetch(`${API_BASE}/api/customers`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (handleAuthError(data)) return;
                
                const customer = data.customers.find(c => c._id === customerId);
                if (!customer) {
                    showPopup('Error âŒ', 'Customer not found', 'alert');
                    return;
                }
                
                // Prompt for new values
                const newName = prompt('Enter new customer name:', customer.customer_name);
                if (newName === null) return;
                
                const newPhone = prompt('Enter new phone number:', customer.customer_phone);
                if (newPhone === null) return;
                
                const newEmail = prompt('Enter new email (optional):', customer.customer_email || '');
                if (newEmail === null) return;
                
                const newAddress = prompt('Enter new address (optional):', customer.customer_address || '');
                if (newAddress === null) return;
                
                // Update customer
                const updateResponse = await fetch(`${API_BASE}/api/customers/${customerId}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        customer_name: newName.trim(),
                        customer_phone: newPhone.trim(),
                        customer_email: newEmail.trim(),
                        customer_address: newAddress.trim()
                    })
                });
                
                const updateData = await updateResponse.json();
                
                if (updateData.success) {
                    showNotification('Success!', 'Customer updated successfully', 'success');
                    loadCustomers();
                } else {
                    showPopup('Error âŒ', updateData.error, 'alert');
                }
            } catch (error) {
                console.error('Error editing customer:', error);
                showPopup('Error âŒ', 'Failed to edit customer. Please try again.', 'alert');
            }
        }

        async function deleteCustomer(customerId, customerName) {
            showPopup(
                'Delete Customer? ðŸ—‘ï¸',
                `Are you sure you want to delete "${customerName}"?\n\nThis action cannot be undone!`,
                'confirm',
                () => processDeleteCustomer(customerId, customerName)
            );
        }

        async function processDeleteCustomer(customerId, customerName) {
            try {
                const response = await fetch(`${API_BASE}/api/customers/${customerId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Deleted!', `${customerName} has been removed`, 'success');
                    loadCustomers();
                } else {
                    showPopup('Error âŒ', data.error, 'alert');
                }
            } catch (error) {
                console.error('Error deleting customer:', error);
                showPopup('Error âŒ', 'Failed to delete customer. Please try again.', 'alert');
            }
        }

        // Invoice functions
        async function loadCustomersForInvoice() {
            try {
                const response = await fetch(`${API_BASE}/api/customers`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                if (data.success) {
                    const select = document.getElementById('customerSelect');
                    select.innerHTML = '<option value="">-- Select a customer or enter new details below --</option>' +
                        data.customers
                            .map(customer => `<option value="${customer._id}" 
                                data-name="${customer.customer_name}" 
                                data-phone="${customer.customer_phone}" 
                                data-email="${customer.customer_email}" 
                                data-address="${customer.customer_address}">
                                ${customer.customer_name} - ${customer.customer_phone}
                            </option>`)
                            .join('');
                }
            } catch (error) {
                console.error('Error loading customers for invoice:', error);
            }
        }

        document.getElementById('customerSelect').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            
            if (this.value) {
                // Populate form fields with selected customer data
                document.getElementById('customerName').value = selectedOption.getAttribute('data-name') || '';
                document.getElementById('customerPhone').value = selectedOption.getAttribute('data-phone') || '';
                document.getElementById('customerEmail').value = selectedOption.getAttribute('data-email') || '';
                document.getElementById('customerAddress').value = selectedOption.getAttribute('data-address') || '';
                
                // Make fields readonly when customer is selected
                document.getElementById('customerName').readOnly = true;
                document.getElementById('customerPhone').readOnly = true;
                document.getElementById('customerEmail').readOnly = true;
                document.getElementById('customerAddress').readOnly = true;
            } else {
                // Clear fields and make them editable
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                document.getElementById('customerEmail').value = '';
                document.getElementById('customerAddress').value = '';
                
                document.getElementById('customerName').readOnly = false;
                document.getElementById('customerPhone').readOnly = false;
                document.getElementById('customerEmail').readOnly = false;
                document.getElementById('customerAddress').readOnly = false;
            }
        });

        async function loadItemsForInvoice() {
            try {
                const response = await fetch(`${API_BASE}/api/items`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                console.log(data);

                if (handleAuthError(data)) return;

                if (data.success) {
                    const select = document.getElementById('invoiceItemSelect');
                    select.innerHTML = '<option value="">Select an item...</option>' +
                        data.items
                            .filter(item => item.stock > 0)
                            .map(item => `<option value="${item._id}" data-price="${item.item_price}" data-stock="${item.stock}" data-unit="${item.unit || 'pcs'}">${item.item_name} - ${formatCurrency(item.item_price)} (Stock: ${item.stock} ${item.unit || 'pcs'})</option>`)
                            .join('');
                } else {
                    showPopup('Error âŒ', 'Error loading items for invoice: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error loading items for invoice:', error);
                showPopup('Error âŒ', 'Failed to load items for invoice. Please refresh the page.', 'alert');
            }
        }

        document.getElementById('invoiceItemSelect').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const stock = selectedOption.getAttribute('data-stock');
            document.getElementById('availableStock').value = stock || '';
        });

        function addItemToInvoice() {
            const select = document.getElementById('invoiceItemSelect');
            const quantity = parseInt(document.getElementById('invoiceQuantity').value);
            const availableStock = parseInt(document.getElementById('availableStock').value);

            if (!select.value) {
                showPopup('No Item Selected âš ï¸', 'Please select an item from the dropdown.', 'alert');
                return;
            }

            if (!quantity || quantity < 1) {
                showPopup('Invalid Quantity âš ï¸', 'Please enter a valid quantity (minimum 1).', 'alert');
                return;
            }

            if (quantity > availableStock) {
                showPopup('Insufficient Stock âš ï¸', `Not enough stock available. Only ${availableStock} units in stock.`, 'alert');
                return;
            }

            const selectedOption = select.options[select.selectedIndex];
            const itemId = select.value;
            const itemName = selectedOption.text.split(' - ')[0];
            const itemPrice = parseFloat(selectedOption.getAttribute('data-price'));
            const itemUnit = selectedOption.getAttribute('data-unit') || 'pcs';

            // Check if item already exists in invoice
            const existingItemIndex = invoiceItems.findIndex(item => item.item_id === itemId);
            if (existingItemIndex >= 0) {
                const totalQuantity = invoiceItems[existingItemIndex].quantity + quantity;
                if (totalQuantity > availableStock) {
                    showPopup('Stock Limit Exceeded âš ï¸', `Total quantity would exceed available stock. Only ${availableStock} units available.`, 'alert');
                    return;
                }
                invoiceItems[existingItemIndex].quantity = totalQuantity;
                invoiceItems[existingItemIndex].unit = itemUnit;
            } else {
                invoiceItems.push({
                    item_id: itemId,
                    name: itemName,
                    price: itemPrice,
                    quantity: quantity,
                    unit: itemUnit
                });
            }

            displayInvoiceItems();
            calculateInvoiceTotals();
            
            showNotification('Added! âœ…', `${itemName} (${quantity} ${itemUnit}) added to invoice`, 'success');

            // Reset form
            select.value = '';
            document.getElementById('invoiceQuantity').value = '1';
            document.getElementById('availableStock').value = '';
        }

        function displayInvoiceItems() {
            const container = document.getElementById('invoiceItemsList');
            
            if (invoiceItems.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No items added to invoice</p></div>';
                return;
            }

            container.innerHTML = invoiceItems.map((item, index) => `
                <div class="invoice-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 2px solid #e9ecef; margin-bottom: 10px; border-radius: 10px; background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div style="flex: 1;">
                        <strong style="color: #FF9933; font-size: 1.1em;">${item.name}</strong><br>
                        <span style="color: #666; font-size: 0.9em;">${item.quantity} ${item.unit || 'pcs'} Ã— ${formatCurrency(item.price)} = <strong style="color: #138808;">${formatCurrency(item.quantity * item.price)}</strong></span>
                    </div>
                    <button onclick="confirmRemoveItemFromInvoice(${index})" 
                            class="btn btn-danger" 
                            style="background: linear-gradient(45deg, #FF6B6B, #FF8E53); border: none; 
                                   padding: 8px 15px; border-radius: 8px; color: white; font-weight: bold;
                                   transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 107, 107, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(255, 107, 107, 0.3)'">
                        ðŸ—‘ï¸ Remove
                    </button>
                </div>
            `).join('');
        }

        function confirmRemoveItemFromInvoice(index) {
            const item = invoiceItems[index];
            showPopup(
                'Remove Item? ðŸ—‘ï¸', 
                `Are you sure you want to remove "${item.name}" from the invoice?`,
                'confirm',
                () => removeItemFromInvoice(index)
            );
        }
        
        function removeItemFromInvoice(index) {
            const item = invoiceItems[index];
            invoiceItems.splice(index, 1);
            displayInvoiceItems();
            calculateInvoiceTotals();
            showPopup('Removed! âœ…', `"${item.name}" removed from invoice successfully.`, 'alert');
        }

        function roundToCustomFormat(amount) {
            // Round to nearest integer first
            const rounded = Math.round(amount);
            const lastDigit = rounded % 10;
            
            if (lastDigit >= 0 && lastDigit <= 4) {
                // Round down to nearest 10 (except 5)
                return Math.floor(rounded / 10) * 10;
            } else if (lastDigit === 5) {
                // Keep as is (ends with 5)
                return rounded;
            } else { // lastDigit >= 6 && lastDigit <= 9
                // Round up to nearest 10
                return Math.ceil(rounded / 10) * 10;
            }
        }

        function calculateInvoiceTotals() {
            if (invoiceItems.length === 0) {
                document.getElementById('invoiceSummary').style.display = 'none';
                document.getElementById('generateBtn').disabled = true;
                return;
            }

            const subtotal = invoiceItems.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountRate = parseFloat(document.getElementById('discountRate').value) || 0;
            const tax = subtotal * (taxRate / 100);
            const discount = subtotal * (discountRate / 100);
            const calculatedTotal = subtotal + tax - discount;
            const total = roundToCustomFormat(calculatedTotal);

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('tax').textContent = formatCurrency(tax);
            document.getElementById('discount').textContent = formatCurrency(discount);
            document.getElementById('total').textContent = formatCurrency(total);

            document.getElementById('invoiceSummary').style.display = 'block';
            document.getElementById('generateBtn').disabled = false;
        }

        async function generateInvoice() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerAddress = document.getElementById('customerAddress').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountRate = parseFloat(document.getElementById('discountRate').value) || 0;
            const sendEmail = document.getElementById('sendEmailCheckbox').checked;
            const notes = document.getElementById('invoiceNotes').value.trim();

            if (!customerName || !customerPhone || !customerAddress) {
                showPopup('Missing Information âš ï¸', 'Please fill in all customer information before generating invoice.', 'alert');
                return;
            }

            if (sendEmail && !customerEmail) {
                showPopup('Email Required âš ï¸', 'Please enter customer email address to send the invoice via email.', 'alert');
                return;
            }

            if (invoiceItems.length === 0) {
                showPopup('No Items âš ï¸', 'Please add items to the invoice before generating.', 'alert');
                return;
            }

            try {
                // Wake up server if needed
                showNotification('Preparing...', 'Connecting to server', 'info');
                await pingServerHealth(false);
                
                showNotification('Creating Invoice...', 'Please wait, generating your invoice', 'info');
                
                const response = await fetchWithRetry(`${API_BASE}/api/invoices`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('session_token')}`
                    },
                    body: JSON.stringify({
                        customer_name: customerName,
                        customer_address: customerAddress,
                        customer_number: customerPhone,
                        customer_email: customerEmail,
                        items: invoiceItems,
                        tax_rate: taxRate,
                        discount_rate: discountRate,
                        notes: notes,
                        send_email: sendEmail
                    })
                }, 4, 2000); // 4 retries with 2 second delay

                // Check if response is ok before parsing JSON
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    // Handle EmailJS email sending if backend prepared email data
                    if (data.send_email_via_frontend && data.email_data && sendEmail) {
                        try {
                            showNotification('Sending Email...', 'Sending invoice via email', 'info');
                            
                            // Build complete invoice HTML template
                            let itemsHTML = '';
                            data.email_data.items.forEach(item => {
                                const itemTotal = item.quantity * item.price;
                                itemsHTML += `
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">${item.name}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">${item.quantity} ${item.unit || 'pcs'}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">Rs ${item.price.toFixed(2)}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">Rs ${itemTotal.toFixed(2)}</td>
                                </tr>`;
                            });
                            
                            // Create complete HTML invoice template
                            const htmlCode = `
                            <html>
                              <body style="font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4;">
                                <div style="max-width: 700px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                  
                                  <!-- App Branding -->
                                  <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #ff9933 0%, #138808 100%); border-radius: 8px;">
                                    <h3 style="color: white; margin: 0; font-size: 16px; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">ðŸ“Š Invoice Management System</h3>
                                    <p style="color: #f0f0f0; margin: 5px 0 0 0; font-size: 12px;">Professional Invoice Generation & Management</p>
                                  </div>
                                  
                                  <!-- Shop Details -->
                                  <div style="border-bottom: 3px solid #138808; padding-bottom: 20px; margin-bottom: 30px;">
                                    <h1 style="color: #138808; margin: 0; font-size: 28px;">ðŸª ${data.email_data.shop_name}</h1>
                                    <p style="margin: 5px 0; color: #666; font-size: 14px;">ðŸ“ ${data.email_data.shop_address}</p>
                                    <p style="margin: 5px 0; color: #666; font-size: 14px;">ðŸ“ž ${data.email_data.shop_phone}</p>
                                  </div>
                                  
                                  <!-- Invoice Header -->
                                  <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                                    <h2 style="color: #138808; margin: 0 0 15px 0; font-size: 20px;">Invoice #${data.email_data.invoice_id}</h2>
                                    <p style="margin: 5px 0; color: #333;"><strong>Date:</strong> ${data.email_data.date}</p>
                                    <p style="margin: 5px 0; color: #333;"><strong>Customer:</strong> ${data.email_data.customer_name}</p>
                                    <p style="margin: 5px 0; color: #333;"><strong>Address:</strong> ${data.email_data.customer_address}</p>
                                    <p style="margin: 5px 0; color: #333;"><strong>Contact:</strong> ${data.email_data.customer_number}</p>
                                  </div>
                                  
                                  <!-- Items Table -->
                                  <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                                    <thead>
                                      <tr style="background-color: #138808; color: white;">
                                        <th style="padding: 12px; text-align: left;">Item</th>
                                        <th style="padding: 12px; text-align: center;">Quantity</th>
                                        <th style="padding: 12px; text-align: right;">Price</th>
                                        <th style="padding: 12px; text-align: right;">Total</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      ${itemsHTML}
                                    </tbody>
                                  </table>
                                  
                                  <!-- Totals Section -->
                                  <div style="border-top: 2px solid #138808; padding-top: 20px;">
                                    <table style="width: 100%; max-width: 300px; margin-left: auto;">
                                      <tr>
                                        <td style="padding: 8px; color: #666;">Subtotal:</td>
                                        <td style="padding: 8px; text-align: right; font-weight: bold;">Rs ${data.email_data.subtotal.toFixed(2)}</td>
                                      </tr>
                                      <tr>
                                        <td style="padding: 8px; color: #666;">Tax:</td>
                                        <td style="padding: 8px; text-align: right; font-weight: bold;">Rs ${data.email_data.tax.toFixed(2)}</td>
                                      </tr>
                                      <tr>
                                        <td style="padding: 8px; color: #666;">Discount:</td>
                                        <td style="padding: 8px; text-align: right; font-weight: bold; color: #d9534f;">- Rs ${data.email_data.discount.toFixed(2)}</td>
                                      </tr>
                                      <tr style="border-top: 2px solid #138808;">
                                        <td style="padding: 12px; font-size: 18px; font-weight: bold; color: #138808;">Total Amount:</td>
                                        <td style="padding: 12px; text-align: right; font-size: 20px; font-weight: bold; color: #138808;">Rs ${data.email_data.total.toFixed(2)}</td>
                                      </tr>
                                    </table>
                                  </div>
                                  
                                  <!-- Footer -->
                                  <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; color: #999; font-size: 12px;">
                                    <p style="margin: 5px 0;">ðŸ™ Thank you for your business!</p>
                                    <p style="margin: 10px 0;">This invoice was generated by <strong style="color: #138808;">Invoice Management System</strong></p>
                                    <p style="margin: 10px 0;">This is an automated email from <strong>${data.email_data.shop_name}</strong>.</p>
                                    <p style="margin: 10px 0;">ðŸ“§ For any queries, contact us at ${data.email_data.shop_phone}</p>
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                                      <p style="margin: 5px 0; color: #bbb; font-size: 11px;">Powered by Invoice Management System | Professional Business Solutions</p>
                                    </div>
                                  </div>
                                </div>
                              </body>
                            </html>
                            `;
                            
                            // Send invoice email using the helper function
                            await sendEmailViaEmailJS(data.email_data.customer_email, htmlCode);
                            
                            console.log('Email sent successfully!');
                            showNotification('Email Sent! ðŸ“§', `Invoice emailed to ${data.email_data.customer_email}`, 'success');
                        } catch (emailError) {
                            console.error('Email sending failed:', emailError);
                            console.error('Error details:', emailError.message || emailError.text);
                            const errorMsg = emailError.message === 'EmailJS not configured on backend' 
                                ? 'Email service not configured. Contact administrator.'
                                : 'Invoice created successfully, but email could not be sent. ' + 
                                  'Go to EmailJS Dashboard â†’ Templates â†’ Edit your template â†’ ' +
                                  'Set "To Email" field to: {{to_email}}';
                            showNotification('Email Failed âš ï¸', errorMsg, 'alert');
                        }
                    }
                    
                    const deliveryNotes = [];
                    if (data.send_email_via_frontend && customerEmail) {
                        deliveryNotes.push(`Email sent to ${customerEmail}.`);
                    }

                    const deliveryText = deliveryNotes.length ? ` ${deliveryNotes.join(' ')}` : '';
                    const message = `Invoice #${data.invoice.invoice_id} created successfully!${deliveryText} Would you like to download the PDF?`;
                    
                    showPopup(
                        'Invoice Created! ðŸ“„', 
                        message,
                        'confirm',
                        () => {
                            const sessionToken = localStorage.getItem('session_token');
                            window.open(`${API_BASE}/api/invoices/${data.invoice.invoice_id}/pdf?session_token=${sessionToken}`, '_blank');
                        }
                    );
                    clearInvoiceForm();
                    // Reload invoices list
                    await loadInvoices();
                } else {
                    showPopup('Error âŒ', 'Error creating invoice: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error creating invoice:', error);
                
                // Check if invoice was created despite error (refresh invoices to see)
                await loadInvoices();
                
                if (error.name === 'AbortError') {
                    showPopup('Timeout â±ï¸', 
                        'The request took too long. However, the invoice may have been created. Please check the "All Invoices" section to verify.\n\nIf the invoice was created, please do not submit again to avoid duplicates.', 
                        'alert');
                } else if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    showPopup('Connection Error âŒ', 
                        'Unable to connect to server. This could be due to:\n\n' +
                        '1. Server is starting up (try again in 30 seconds)\n' +
                        '2. Network connection issue\n' +
                        '3. Server maintenance\n\n' +
                        'Please wait a moment and try again.', 
                        'alert');
                } else {
                    showPopup('Error âŒ', 
                        'Error: ' + error.message + '\n\nPlease check the "All Invoices" section to see if the invoice was created.\n\nIf created, do not submit again.',
                        'alert');
                }
            }
        }

        function clearInvoiceForm() {
            document.getElementById('customerSelect').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerName').readOnly = false;
            document.getElementById('customerPhone').readOnly = false;
            document.getElementById('customerEmail').readOnly = false;
            document.getElementById('customerAddress').readOnly = false;
            document.getElementById('sendEmailCheckbox').checked = false;
            document.getElementById('invoiceNotes').value = '';
            document.getElementById('taxRate').value = '0';
            document.getElementById('discountRate').value = '0';
            invoiceItems = [];
            displayInvoiceItems();
            calculateInvoiceTotals();
        }

        // Recalculate totals when tax/discount inputs change
        document.getElementById('taxRate').addEventListener('input', calculateInvoiceTotals);
        document.getElementById('discountRate').addEventListener('input', calculateInvoiceTotals);

        // Invoices functions
        async function loadInvoices() {
            try {
                const response = await fetch(`${API_BASE}/api/invoices`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                if (data.success) {
                    displayInvoices(data.invoices);
                } else {
                    showPopup('Error âŒ', 'Error loading invoices: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error loading invoices:', error);
                showPopup('Error âŒ', 'Failed to load invoices. Please refresh the page.', 'alert');
            }
        }

        function displayInvoices(invoices) {
            const invoicesTable = document.getElementById('invoicesTable');
            
            // Guard against undefined/null invoices
            if (!invoices || !Array.isArray(invoices)) {
                console.warn('displayInvoices called with invalid data:', invoices);
                invoicesTable.innerHTML = '<div class="empty-state"><h3>âš ï¸ Unable to load invoices</h3><p>Please refresh the page</p></div>';
                return;
            }
            
            if (invoices.length === 0) {
                invoicesTable.innerHTML = '<div class="empty-state"><h3>ðŸ“‹ No Invoices Found</h3><p>Create your first invoice to get started</p></div>';
                return;
            }

            invoicesTable.innerHTML = `
                <div class="invoices-grid">
                    ${invoices.map(invoice => `
                        <div class="invoice-card">
                            <div class="invoice-card-header">
                                <h3 class="invoice-card-id">#${invoice.invoice_id}</h3>
                                <span class="invoice-card-date">ðŸ“… ${formatDate(invoice.order_date)}</span>
                            </div>
                            <div class="invoice-card-body">
                                <div class="invoice-card-customer">
                                    <span>ðŸ‘¤</span>
                                    <span>${invoice.customer_name}</span>
                                </div>
                                <div class="invoice-card-total">
                                    <span class="invoice-card-total-label">Total Amount</span>
                                    <span class="invoice-card-total-value">â‚¹${invoice.total.toFixed(2)}</span>
                                </div>
                            </div>
                            <div class="invoice-card-actions">
                                <button onclick="viewInvoiceDetails(${invoice.invoice_id})" class="btn btn-primary" title="View Details">ðŸ‘ï¸ View</button>
                                <button onclick="downloadInvoicePDF(${invoice.invoice_id})" class="btn btn-success" title="Download PDF">ðŸ“„ PDF</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function viewInvoiceDetails(invoiceId) {
            try {
                const response = await fetch(`${API_BASE}/api/invoices/${invoiceId}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();

                if (handleAuthError(data)) return;

                if (data.success) {
                    const invoice = data.invoice;
                    const details = `
                        Invoice ID: #${invoice.invoice_id}
                        Customer: ${invoice.customer_name}
                        Address: ${invoice.customer_address}
                        Phone: ${invoice.customer_number}
                        Date: ${formatDate(invoice.order_date)}
                        
                        Items:
                        ${invoice.items.map(item => `${item.name} - ${item.quantity} x ${formatCurrency(item.price)} = ${formatCurrency(item.quantity * item.price)}`).join('\n')}
                        
                        Subtotal: ${formatCurrency(invoice.subtotal)}
                        Tax (${(invoice.tax_rate ?? 0).toFixed(2)}%): ${formatCurrency(invoice.tax)}
                        Discount (${(invoice.discount_rate ?? 0).toFixed(2)}%): ${formatCurrency(invoice.discount)}
                        Total: ${formatCurrency(invoice.total)}
                    `;
                    alert(details);
                } else {
                    showPopup('Error âŒ', 'Error loading invoice details: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error loading invoice details:', error);
                showPopup('Error âŒ', 'Failed to load invoice details. Please try again.', 'alert');
            }
        }

        function downloadInvoicePDF(invoiceId) {
            const sessionToken = localStorage.getItem('session_token');
            window.open(`${API_BASE}/api/invoices/${invoiceId}/pdf?session_token=${sessionToken}`, '_blank');
        }

        function searchInvoices() {
            const searchTerm = document.getElementById('invoiceSearch').value.trim().toLowerCase();
            
            if (!searchTerm) {
                loadInvoices();
                return;
            }

            // Simple client-side search (you could implement server-side search)
            const filteredInvoices = currentInvoices.filter(invoice => 
                invoice.customer_name.toLowerCase().includes(searchTerm) ||
                invoice.invoice_id.toString().includes(searchTerm)
            );
            
            displayInvoices(filteredInvoices);
        }

        // Initialize the application
        let currentInvoices = [];
        let qrScannerStream = null;

        // QR Code Functions
        async function printAllQRCodes() {
            try {
                showNotification('Generating QR Codes...', 'Please wait while we generate all QR codes', 'info');
                
                const response = await fetch(`${API_BASE}/api/items`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (handleAuthError(data)) return;
                
                if (!data.success || data.items.length === 0) {
                    showPopup('No Items Found âŒ', 'There are no items to generate QR codes. Please add items first.', 'alert');
                    return;
                }
                
                const items = data.items;
                const qrCodesData = [];
                
                console.log(`Fetching QR codes for ${items.length} items...`);
                
                // Fetch QR codes for all items
                for (const item of items) {
                    try {
                        const qrResponse = await fetch(`${API_BASE}/api/items/${item._id}/qrcode`, {
                            headers: getAuthHeaders()
                        });
                        const qrData = await qrResponse.json();
                        
                        if (qrData.success && qrData.qr_code) {
                            qrCodesData.push({
                                name: item.item_name,
                                price: item.item_price,
                                unit: item.unit || 'pcs',
                                qrCode: qrData.qr_code
                            });
                            console.log(`âœ“ QR code generated for: ${item.item_name}`);
                        } else {
                            console.warn(`âœ— Failed to generate QR for: ${item.item_name}`, qrData);
                        }
                    } catch (error) {
                        console.error(`âœ— Error fetching QR for ${item.item_name}:`, error);
                    }
                }
                
                console.log(`Successfully generated ${qrCodesData.length} QR codes out of ${items.length} items`);
                
                if (qrCodesData.length === 0) {
                    showPopup('Error âŒ', 'Failed to generate QR codes. Please check the console for details and try again.', 'alert');
                    return;
                }
                
                // Generate print page with 8 rows x 5 columns = 40 QR codes
                generateQRPrintPage(qrCodesData);
                
            } catch (error) {
                console.error('Error printing QR codes:', error);
                showPopup('Error âŒ', 'Failed to print QR codes. Please try again.', 'alert');
            }
        }
        
        function generateQRPrintPage(qrCodesData) {
            // Create pages with 40 QR codes per page (8 rows x 5 columns)
            const qrCodesPerPage = 40;
            const totalPages = Math.ceil(qrCodesData.length / qrCodesPerPage);
            let allPagesHTML = '';
            
            for (let page = 0; page < totalPages; page++) {
                let qrCardsHTML = '';
                const startIndex = page * qrCodesPerPage;
                const endIndex = Math.min(startIndex + qrCodesPerPage, qrCodesData.length);
                
                // Fill current page with QR codes
                for (let i = 0; i < qrCodesPerPage; i++) {
                    const dataIndex = startIndex + i;
                    if (dataIndex < qrCodesData.length) {
                        const item = qrCodesData[dataIndex];
                        qrCardsHTML += `
                            <div class="qr-card">
                                <img src="data:image/png;base64,${item.qrCode}" alt="QR Code">
                                <div class="item-name">${item.name}</div>
                                <div class="item-price">Rs ${item.price.toFixed(2)} / ${item.unit}</div>
                            </div>
                        `;
                    } else {
                        // Empty slot for remaining spaces on last page
                        qrCardsHTML += `
                            <div class="qr-card empty">
                                <div class="empty-text">-</div>
                            </div>
                        `;
                    }
                }
                
                // Add page HTML
                allPagesHTML += 
                    '<div class="page" style="' + (page > 0 ? 'page-break-before: always;' : '') + '">' +
                        '<div class="header">' +
                            '<h1>ðŸª Item QR Codes - Invoice Management System</h1>' +
                            '<p>Page ' + (page + 1) + ' of ' + totalPages + ' | Items: ' + (startIndex + 1) + '-' + endIndex + ' of ' + qrCodesData.length + ' | Date: ' + new Date().toLocaleDateString() + '</p>' +
                        '</div>' +
                        '<div class="qr-grid">' +
                            qrCardsHTML +
                        '</div>' +
                        '<div class="footer">' +
                            '<p>ðŸ“± Scan any QR code to quickly add item to invoice | Page ' + (page + 1) + '/' + totalPages + '</p>' +
                        '</div>' +
                    '</div>';
            }
            
            const styleHTML = 
                '<style>' +
                    '* { margin: 0; padding: 0; box-sizing: border-box; }' +
                    '@page { size: A4 landscape; margin: 10mm; }' +
                    'body { font-family: Arial, sans-serif; padding: 10px; background: white; }' +
                    '.page { min-height: 100vh; display: flex; flex-direction: column; padding: 20px; }' +
                    '.header { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 3px solid #138808; }' +
                    '.header h1 { color: #138808; font-size: 24px; margin-bottom: 5px; }' +
                    '.header p { color: #666; font-size: 14px; }' +
                    '.qr-grid { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(8, 1fr); gap: 8px; width: 100%; flex: 1; }' +
                    '.qr-card { border: 2px solid #138808; border-radius: 8px; padding: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; page-break-inside: avoid; }' +
                    '.qr-card.empty { border: 2px dashed #ddd; background: #f9f9f9; }' +
                    '.qr-card img { width: 100%; max-width: 120px; height: auto; margin-bottom: 5px; }' +
                    '.item-name { font-weight: bold; font-size: 11px; text-align: center; color: #138808; margin-bottom: 3px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%; }' +
                    '.item-price { font-size: 10px; color: #666; text-align: center; }' +
                    '.empty-text { color: #ccc; font-size: 24px; font-weight: bold; }' +
                    '.footer { text-align: center; margin-top: 15px; padding-top: 10px; border-top: 2px solid #138808; color: #666; font-size: 11px; }' +
                    '@media print { body { padding: 5px; } .header h1 { font-size: 20px; } .qr-grid { gap: 5px; } .qr-card { padding: 5px; } .no-print { display: none !important; } }' +
                '</style>';
            
            // Show the in-page modal
            const printModal = document.getElementById('printQRModal');
            const printContent = document.getElementById('printQRContent');
            printContent.innerHTML = styleHTML + allPagesHTML;
            printModal.style.display = 'flex';
            
            showNotification('QR Codes Ready! ðŸŽ‰', 'Generated ' + qrCodesData.length + ' QR codes across ' + totalPages + ' pages', 'success');
        }
        
        function closePrintQRModal() {
            document.getElementById('printQRModal').style.display = 'none';
        }
        
        async function showItemQR(itemId) {
            try {
                const response = await fetch(`${API_BASE}/api/items/${itemId}/qrcode`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                
                if (data.success) {
                    showQRCodeModal(data.qr_code, data.item);
                } else {
                    showPopup('Error âŒ', 'Failed to generate QR code: ' + data.error, 'alert');
                }
            } catch (error) {
                console.error('Error fetching QR code:', error);
                showPopup('Error âŒ', 'Failed to generate QR code', 'alert');
            }
        }
        
        function showQRCodeModal(qrCode, item) {
            const modal = document.getElementById('qrModal');
            const img = document.getElementById('qrCodeImage');
            const info = document.getElementById('qrItemInfo');
            
            img.src = `data:image/png;base64,${qrCode}`;
            info.textContent = `${item.item_name} - Rs ${item.item_price} per ${item.unit}`;
            
            modal.style.display = 'flex';
            modal.classList.add('show');
        }
        
        function closeQRModal() {
            const modal = document.getElementById('qrModal');
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 200);
        }
        
        function printQR() {
            const img = document.getElementById('qrCodeImage');
            const info = document.getElementById('qrItemInfo');
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(
                '<html>' +
                    '<head>' +
                        '<title>Print QR Code</title>' +
                        '<style>' +
                            'body { text-align: center; font-family: Arial; padding: 20px; }' +
                            'img { max-width: 400px; border: 2px solid #138808; padding: 20px; }' +
                            'h2 { color: #138808; }' +
                        '</style>' +
                    '</head>' +
                    '<body>' +
                        '<h2>Item QR Code</h2>' +
                        '<img src="' + img.src + '">' +
                        '<h3>' + info.textContent + '</h3>' +
                        '<p>Scan this QR code to quickly add item to invoice</p>' +
                        '<scr' + 'ipt>' +
                            'window.onload = function() {' +
                                'window.print();' +
                                'setTimeout(function() { window.close(); }, 100);' +
                            '}' +
                        '</scr' + 'ipt>' +
                    '</body>' +
                '</html>'
            );
            printWindow.document.close();
        }
        
        // QR Scanner Functions
        function openQRScanner() {
            const modal = document.getElementById('qrScannerModal');
            const video = document.getElementById('qrVideo');
            
            modal.style.display = 'flex';
            modal.classList.add('show');
            
            // Start camera
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(function(stream) {
                    qrScannerStream = stream;
                    video.srcObject = stream;
                    video.setAttribute('playsinline', true);
                    video.play();
                    requestAnimationFrame(scanQRCode);
                })
                .catch(function(err) {
                    console.error('Error accessing camera:', err);
                    showPopup('Camera Error âŒ', 'Could not access camera. Please check permissions.', 'alert');
                    closeQRScanner();
                });
        }
        
        function scanQRCode() {
            const video = document.getElementById('qrVideo');
            const canvas = document.getElementById('qrCanvas');
            const modal = document.getElementById('qrScannerModal');
            
            if (modal.style.display === 'none' || !video.videoWidth) {
                if (modal.style.display !== 'none') {
                    requestAnimationFrame(scanQRCode);
                }
                return;
            }
            
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
                try {
                    const itemData = JSON.parse(code.data);
                    console.log('QR Code scanned:', itemData);
                    
                    closeQRScanner();
                    addScannedItemToInvoice(itemData);
                } catch (e) {
                    console.error('Invalid QR code data:', e);
                }
            }
            
            requestAnimationFrame(scanQRCode);
        }
        
        function closeQRScanner() {
            const modal = document.getElementById('qrScannerModal');
            const video = document.getElementById('qrVideo');
            
            if (qrScannerStream) {
                qrScannerStream.getTracks().forEach(track => track.stop());
                qrScannerStream = null;
            }
            
            video.srcObject = null;
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 200);
        }
        
        function addScannedItemToInvoice(itemData) {
            showInputPopup(
                'ðŸŽ¯ Item Scanned Successfully!',
                `<strong>${itemData.item_name}</strong><br>Price: Rs ${itemData.item_price} per ${itemData.unit}<br><br>Enter quantity:`,
                'number',
                '1',
                (quantity) => {
                    if (!quantity || quantity <= 0) {
                        showPopup('Invalid Quantity âš ï¸', 'Please enter a valid quantity', 'alert');
                        return;
                    }
                    
                    // Set the item in the dropdown
                    const select = document.getElementById('invoiceItemSelect');
                    select.value = itemData.item_id;
                    
                    // Set quantity
                    document.getElementById('invoiceQuantity').value = quantity;
                    
                    // Trigger the add item action
                    addItemToInvoice();
                }
            );
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Add search functionality with Enter key
            document.getElementById('itemSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchItems();
                }
            });
            
            document.getElementById('customerSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchCustomers();
                }
            });
            
            document.getElementById('invoiceSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchInvoices();
                }
            });
        });
    </script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init('HiT1qgF3NG4BIwyQY');
        })();
    </script>
    
    <!-- Footer -->
    <div style="text-align: center; padding: 30px 20px; margin-top: 40px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <p style="color: #138808; font-weight: bold; font-size: 1.2em; margin: 0 0 10px 0;">
            âš¡ Kandhal Invoice System
        </p>
        <p style="color: #666; font-size: 0.9em; margin: 0;">
            Powered by Kandhal Technologies | Modern Invoice Management Solution
        </p>
    </div>
</body>
</html>
